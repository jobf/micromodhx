<xml>


<pragma once="true" />

	<set name="ROOT" value="${this_dir}" />
	<set name="MICROMODC" value="external/micromod/micromod-c" />
	
	<set name="HL_INCLUDE" value="/usr/include" if="linux" />

	<!-- <set name="HASHLINK" value="${ROOT}/scratch/hashlink-1.12" /> -->
	<set name="HL_INCLUDE" value="${HASHLINK}/include" />

   <echo value="hashlink include: ${HL_INCLUDE}" />
	
	<files id="micromodHl">
		<compilerflag value="-I${HL_INCLUDE}" />
		<compilerflag value="-I${ROOT}/${MICROMODC}" />

		<compilerflag value="-std=c11" unless="windows" />
		<compilerflag value="-DLIBHL_EXPORTS" />
		<compilerflag value="-DHAVE_CONFIG_H" />
		<compilerflag value="-DPCRE2_CODE_UNIT_WIDTH=16" />


		<file name="${ROOT}/${MICROMODC}/micromod.c" />
		<file name="${ROOT}/hdll/micromodHl.c" />
		<!-- <objdir value="${ROOT}/hdll/obj" /> was trying to move obj from root -->
	</files>

	<target id="default" output="micromodHl" toolid="dll" tool="linker">
		<files id="micromodHl" />
		<lib name="-lhl" unless="windows" />
		<lib name="-pthread" if="linux" />
		<!-- Make hashlink pick up binaries in the same directory as itself -->
		<!-- <lib name="-Wl,-rpath=$ORIGIN" if="linux" /> -->

		<ext value=".hdll" />
		<outdir name="${ROOT}/hdll/bin" />
	</target>

</xml>